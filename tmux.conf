##### General #####
# Faster Esc in copy-mode-vi etc.
set-option -sg escape-time 0

# Prefix: Ctrl-Space (note: some terminals/OS shortcuts may swallow this)
unbind C-b
set-option -g prefix C-Space
bind C-Space send-prefix

# Index panes/windows from 1
set-option -g base-index 1
setw -g pane-base-index 1

# History
set-option -g history-limit 100000

# Truecolor + sane default terminal
set-option -g default-terminal "tmux-256color"
set-option -as terminal-overrides ',*:Tc'

# Focus events (better app redraw behavior)
set-option -g focus-events on


##### Status line (yours) #####
set-option -g status-right-length 140
set-option -g status-right-style default
set-option -g status-right ' #[fg=colour111,bg=default]%l:%M %p#[default] #[fg=colour111]%a %d-%b-%Y'
set-option -g status-bg colour234
set-option -g status-fg colour111


##### Pane navigation (vim-like) #####
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

##### Pane resizing (repeatable, big steps) #####
bind -r H resize-pane -L 15
bind -r J resize-pane -D 15
bind -r K resize-pane -U 15
bind -r L resize-pane -R 15


##### Copy-mode: vim keys + system clipboard #####
# Use vi-style keys in copy mode
setw -g mode-keys vi

# Optional: mouse to select/copy easily (still uses vi copy-mode when entering it)
set-option -g mouse on

# Selection ergonomics in copy-mode-vi
bind -T copy-mode-vi v send -X begin-selection          # visual
bind -T copy-mode-vi V send -X select-line              # visual line
bind -T copy-mode-vi C-v send -X rectangle-toggle       # visual block
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "#{?@copy_cmd,#{@copy_cmd},cat}"

# Also allow prefix + y to copy the whole visible pane to clipboard
bind y capture-pane -J \; save-buffer - \; run-shell 'sh -c "#{?@copy_cmd,#{@copy_cmd},cat}" < /dev/stdin' \; delete-buffer

# Detect platform clipboard command once and store in a user option @copy_cmd
# macOS: pbcopy; Linux: xclip (clipboard selection)
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  'set -g @copy_cmd "pbcopy"'
if-shell '[ -z "#{@copy_cmd}" ] && command -v xclip >/dev/null 2>&1' \
  'set -g @copy_cmd "xclip -in -selection clipboard"'
if-shell '[ -z "#{@copy_cmd}" ] && command -v wl-copy >/dev/null 2>&1' \
  'set -g @copy_cmd "wl-copy"'

# For completeness, keep the classic copy too (copies to tmux buffer only)
bind -T copy-mode-vi Enter send -X copy-selection-and-cancel


##### Quality-of-life (optional but handy) #####
# Quickly toggle synchronize-panes (type once, all panes receive keys)
bind s setw synchronize-panes\; display-message "synchronize-panes: #{?pane_synchronized,on,off}"

# Split panes keeping current path
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# Cycle last active pane
bind Space last-pane

# Fast session/window chooser (full-screen tree)
bind t choose-tree -Zw

# Reload config
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"
